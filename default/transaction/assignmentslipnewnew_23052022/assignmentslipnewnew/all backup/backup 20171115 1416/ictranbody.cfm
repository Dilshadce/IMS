
    <cfif left(form.refno,1) neq "S">
     <cfset trancodestart = 0>
	 <cfset xunit = "Unit">
     <cfif isdefined('refnofound')>
	 <!--- refresh ictran --->
	 <cfquery name="resettrancode" datasource="#dts#">
     UPDATE assignmentslip
     SET trancodestart=0,trancodeend=0 
     WHERE refno = "#assignmentslipno#"
     </cfquery>
     <!--- refresh ictran --->
     <cfquery name="checkassign" datasource="#dts#">
     SELECT trancodestart,trancodeend FROM assignmentslip WHERE refno = "#assignmentslipno#"
     </cfquery>
     <cfif checkassign.trancodestart eq 0 and checkassign.trancodeend eq 0>
         <cfquery name="getlatesttrancode" datasource="#dts#">
         SELECT trancodeend FROM assignmentslip WHERE invoiceno = "#refnofound#"
         ORDER BY trancodeend desc
         </cfquery>
         <cfquery name="getlatesttrancodeictran" datasource="#dts#">
         SELECT trancode FROM ictran WHERE refno = "#refnofound#"
         ORDER BY trancode desc
         </cfquery>
         <cfif getlatesttrancodeictran.trancode gt getlatesttrancode.trancodeend>
             <cfset getlatesttrancode.trancodeend = getlatesttrancodeictran.trancode>
         </cfif>
         <cfif getlatesttrancode.recordcount eq 0>
         <cfset trancodestart = 0>
         <cfelse>
         <cfset trancodestart = getlatesttrancode.trancodeend+20>
         </cfif>
     <cfelse>
     	   <cfset trancodestart = checkassign.trancodeend-1>
     </cfif>
	 </cfif>
     <cfset starttrancode = trancodestart + 1>
     
     <!---Name--->
     <cfset trancodestart = trancodestart + 1>
	 <cfif form.custtotalgross neq 0>
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,
            currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'Name', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#form.empname# (#getposition.position#)">, 
            '', 
            '',
            '0',
            0, 
            '',
             0,
            0,
            0,
            0,
            0,
            0, 
            '0',
            '',
            0.00000,
            '0',
             0,
              '',
              '0',
               '0',
                0,
                0,
                0,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
	 </cfif>
     
	 <cfif val(form.custsalary) neq 0> 
     <!---Salary---->
     <cfset xqty=1>
     <cfif form.invdesp2 eq "">
     <cfif form.paymenttype eq 'hr'>
     <cfset xqty=val(form.custsalaryhrs)>
     <cfelseif form.paymenttype eq 'day' >
     <cfset xqty=val(form.custsalaryday)>
     </cfif>
     
     <cfset xprice=val(form.custsalary)>
     <cfif form.paymenttype eq 'hr'>
		<cfset xprice=val(form.custusualpay)>
		<cfset xunit ="Hour">
     <cfelseif form.paymenttype eq 'day' >
		<cfset xprice=val(form.custusualpay)>
		<cfset xunit ="Day">
	<cfelse>
		<cfset xunit ="Month">
     </cfif>
     <cfelse>
     <cfset xprice = numberformat(form.custsalary,'_.__')>
     </cfif>
     <cfif val(form.firstrate) neq 0 and val(form.secondrate) neq 0>
     
     <cfset trancodestart = trancodestart + 1>
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,
            currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'Salary', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="Normal">, 
            '', 
            '',
            '#val(xqty)#',
            #numberformat(val(form.firstrate),'.__')#, 
            '#xunit#',
             #numberformat(val(form.firstrate),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.firstrate),'.__')#, 
            '0',
            '',
            0.00000,
            '#val(xqty)#',
             #numberformat(val(form.firstrate),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.firstrate),'.__')#,
                0,
                #numberformat(val(form.firstrate),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     
     
      <cfset trancodestart = trancodestart + 1>
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,
            currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'Salary', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="Normal">, 
            '', 
            '',
            '#val(xqty)#',
            #numberformat(val(form.secondrate),'.__')#, 
            '#xunit#',
             #numberformat(val(form.secondrate),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.secondrate),'.__')#, 
            '0',
            '',
            0.00000,
            '#val(xqty)#',
             #numberformat(val(form.secondrate),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.secondrate),'.__')#,
                0,
                #numberformat(val(form.secondrate),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     
     <cfelse>
	 <cfset trancodestart = trancodestart + 1>
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,
            currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'Salary', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="Normal">, 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="">, 
            '',
            '#val(xqty)#',
            #numberformat(val(xprice),'.__')#, 
            '#xunit#',
             #numberformat(val(form.custsalary),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.custsalary),'.__')#, 
            '0',
            '',
            0.00000,
            '#val(xqty)#',
             #numberformat(val(xprice),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.custsalary),'.__')#,
                0,
                #numberformat(val(form.custsalary),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     </cfif>
     
     <cfset xunit = "Unit">
	 
     <cfloop from="1" to="10" index="i">
     <cfset trancodestart = trancodestart + 1>
	 <cfif evaluate('form.lvltype#i#') neq "" and val(evaluate('form.lvltotaler#i#')) neq 0 and val(evaluate('form.lvlerdayhr#i#')) neq 0 and val(evaluate('form.lvlerrate#i#')) neq 0 >
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
                '#form.custno#',
                '#trancodestart#','#trancodestart#',
                '',
                '19', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('form.lvldesp#i#')#">, 
                '', 
                '',
                '#val(evaluate('form.lvlerdayhr#i#'))#',
                #numberformat(evaluate('form.lvlerrate#i#'),'.__')#, 
                '#xunit#',
                 #numberformat(evaluate('form.lvltotaler#i#'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('form.lvltotaler#i#'),'.__')#, 
                '0',
                '',
                0.00000,
                '#val(evaluate('form.lvlerdayhr#i#'))#',
                 #numberformat(evaluate('form.lvlerrate#i#'),'.__')#,
                  '#xunit#',
                  '1',
                   '1',
                    #numberformat(evaluate('form.lvltotaler#i#'),'.__')#,
                    0,
                    #numberformat(evaluate('form.lvltotaler#i#'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#huserid#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>
     
     
     <cfloop from="1" to="8" index="i">
     <cfset trancodestart = trancodestart + 1>
     <cfif val(evaluate('form.custotrate#i#')) neq 0 and val(evaluate('form.custothour#i#')) neq 0 and val(evaluate('form.custot#i#')) neq 0> 
     <!---OT---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            '<cfif i eq 1>OT1<cfelseif i eq 2>OT15<cfelseif i eq 3>OT2<cfelseif i eq 4>OT3<cfelseif i eq 5>OT5<cfelseif i eq 6>OT6<cfelseif i eq 7>OT7<cfelse>OT8</cfif>', 
            '<cfif i eq 1>Over Time 1.0<cfelseif i eq 2>Over Time 1.5<cfelseif i eq 3>Over Time 2.0<cfelseif i eq 4>Over Time 3.0<cfelseif i eq 5>Rest Day 1.0<cfelseif i eq 6>Rest Day 2.0<cfelseif i eq 7>Public Holiday 1.0<cfelse>Public Holiday 2.0</cfif>', 
            '', 
            '',
            '#val(evaluate('form.custothour#i#'))#',
            #numberformat(evaluate('form.custotrate#i#'),'.__')#, 
            '#xunit#',
             #numberformat(evaluate('form.custot#i#'),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(evaluate('form.custot#i#'),'.__')#, 
            '0',
            '',
            0.00000,
            '#val(evaluate('form.custothour#i#'))#',
             #numberformat(evaluate('form.custotrate#i#'),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(evaluate('form.custot#i#'),'.__')#,
                0,
                #numberformat(evaluate('form.custot#i#'),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     </cfloop>
     
     <!--- Fixed allowance --->
     
     <cfloop from="1" to="6" index="i">
     <cfset trancodestart = trancodestart + 1>
	 <cfif evaluate('form.fixawcode#i#') neq "" and val(evaluate('form.fixawer#i#')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,brem5,brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
                '#form.custno#',
                '#trancodestart#','#trancodestart#',
                '',
                '#evaluate('form.fixawcode#i#')#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('form.fixawdesp#i#')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('form.fixawer#i#'),'.__')#, 
                '#xunit#',
                 #numberformat(evaluate('form.fixawer#i#'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('form.fixawer#i#'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('form.fixawer#i#'),'.__')#,
                  '#xunit#',
                  '1',
                   '1',
                    #numberformat(evaluate('form.fixawer#i#'),'.__')#,
                    0,
                    #numberformat(evaluate('form.fixawer#i#'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#huserid#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>     
     
     
     <cfloop from="1" to="18" index="i">
     <cfset trancodestart = trancodestart + 1>
	 <cfif evaluate('form.allowance#i#') neq "" and val(evaluate('form.awer#i#')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,brem5,brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
                '#form.custno#',
                '#trancodestart#','#trancodestart#',
                '',
                '#evaluate('form.allowance#i#')#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('form.allowancedesp#i#')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('form.awer#i#'),'.__')#, 
                '#xunit#',
                 #numberformat(evaluate('form.awer#i#'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('form.awer#i#'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('form.awer#i#'),'.__')#,
                  '#xunit#',
                  '1',
                   '1',
                    #numberformat(evaluate('form.awer#i#'),'.__')#,
                    0,
                    #numberformat(evaluate('form.awer#i#'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#huserid#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>
     
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.custallowancerate4) neq 0>
     <!---Allowance 4---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'allowance4', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#form.aw104desp#">, 
            '', 
            '',
            '1',
            #numberformat(val(form.custallowancerate4),'.__')#, 
            '#xunit#',
             #numberformat(val(form.custallowancerate4),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.custallowancerate4),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.custallowancerate4),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.custallowancerate4),'.__')#,
                0,
                #numberformat(val(form.custallowancerate4),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestart = trancodestart + 1>
      <cfif val(form.custallowancerate5) neq 0>
     <!---Allowance 5---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'allowance5', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#form.aw105desp#">, 
            '', 
            '',
            '1',
            #numberformat(val(form.custallowancerate5),'.__')#, 
            '#xunit#',
             #numberformat(val(form.custallowancerate5),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.custallowancerate5),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.custallowancerate5),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.custallowancerate5),'.__')#,
                0,
                #numberformat(val(form.custallowancerate5),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestart = trancodestart + 1>
      <cfif val(form.custallowancerate6) neq 0>
     <!---Allowance 6---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'allowance6', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#form.aw106desp#">, 
            '', 
            '',
            '1',
            #numberformat(val(form.custallowancerate6),'.__')#, 
            '#xunit#',
             #numberformat(val(form.custallowancerate6),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.custallowancerate6),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.custallowancerate6),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.custallowancerate6),'.__')#,
                0,
                #numberformat(val(form.custallowancerate6),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.custpayback) neq 0> 
     <!---BACK PAY---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'backoverpay', 
            <cfif val(form.custpayback) lt 0>'Over Pay'<cfelse>'Back Pay'</cfif>, 
            '', 
            '',
            '1',
            #numberformat(val(form.custpayback),'.__')#, 
            '#xunit#',
             #numberformat(val(form.custpayback),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.custpayback),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.custpayback),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.custpayback),'.__')#,
                0,
                #numberformat(val(form.custpayback),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.custcpf) neq 0> 
     <!---CPF---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'EPFYER', 
            'EPF', 
            '', 
            '',
            '1',
            #numberformat(val(form.custcpf),'.__')#, 
            '#xunit#',
             #numberformat(val(form.custcpf),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.custcpf),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.custcpf),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.custcpf),'.__')#,
                0,
                #numberformat(val(form.custcpf),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.custsdf) neq 0>
     <!---SOCSO---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'SOCSOYER', 
            'SOCSO', 
            '', 
            '',
            '1',
            #numberformat(val(form.custsdf),'.__')#, 
            '#xunit#',
             #numberformat(val(form.custsdf),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.custsdf),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.custsdf),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.custsdf),'.__')#,
                0,
                #numberformat(val(form.custsdf),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.nscustded) neq 0>
     <!---NS DEDUCTION---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (

            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'NS', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#form.nsdeddesp#">, 
            '', 
            '',
            '1',
            #numberformat(val(form.nscustded)*-1,'.__')#, 
            '#xunit#',
             #numberformat(val(form.nscustded)*-1,'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.nscustded)*-1,'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.nscustded)*-1,'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.nscustded)*-1,'.__')#,
                0,
                #numberformat(val(form.nscustded)*-1,'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
      <cfset trancodestart = trancodestart + 1>
     <cfif val(form.adminfee) neq 0>
     <!---NS DEDUCTION---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'adminfee', 
            'Admin Fee', 
            '', 
            '',
            '1',
            #numberformat(val(form.adminfee),'.__')#, 
            '#xunit#',
             #numberformat(val(form.adminfee),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.adminfee),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.adminfee),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.adminfee),'.__')#,
                0,
                #numberformat(val(form.adminfee),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     <cfloop from="1" to="6" index="i">
     <cfset trancodestart = trancodestart + 1>
	 <cfif evaluate('form.billitem#i#') neq "" and val(evaluate('form.billitemamt#i#')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
                '#form.custno#',
                '#trancodestart#','#trancodestart#',
                '',
                '#evaluate('form.billitem#i#')#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('form.billitemdesp#i#')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('form.billitemamt#i#'),'.__')#, 
                '#xunit#',
                 #numberformat(evaluate('form.billitemamt#i#'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('form.billitemamt#i#'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('form.billitemamt#i#'),'.__')#,
                  '#xunit#',
                  '1',
                   '1',
                    #numberformat(evaluate('form.billitemamt#i#'),'.__')#,
                    0,
                    #numberformat(evaluate('form.billitemamt#i#'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#huserid#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>
     
     
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.addchargecust) neq 0>
     
     <!---other 1---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'other - #form.addchargecode#', 
            '#addchargedesp#', 
            '', 
            '',
            '1',
            #numberformat(val(form.addchargecust),'.__')#, 
            '#xunit#',
             #numberformat(val(form.addchargecust),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.addchargecust),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.addchargecust),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.addchargecust),'.__')#,
                0,
                #numberformat(val(form.addchargecust),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     
     
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.addchargecust2) neq 0>
     
     <!---other 2---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'other2 - #form.addchargecode#', 
            '#addchargedesp2#', 
            '', 
            '',
            '1',
            #numberformat(val(form.addchargecust2),'.__')#, 
            '#xunit#',
             #numberformat(val(form.addchargecust2),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.addchargecust2),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.addchargecust2),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.addchargecust2),'.__')#,
                0,
                #numberformat(val(form.addchargecust2),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.addchargecust3) neq 0>
     <!---other 3---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'other3 - #form.addchargecode#', 
            '#addchargedesp3#', 
            '', 
            '',
            '1',
            #numberformat(val(form.addchargecust3),'.__')#, 
            '#xunit#',
             #numberformat(val(form.addchargecust3),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.addchargecust3),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.addchargecust3),'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.addchargecust3),'.__')#,
                0,
                #numberformat(val(form.addchargecust3),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestart = trancodestart + 1>
     <cfif val(form.rebate) neq 0>
     <!---Rebate---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
            '#form.custno#',
            '#trancodestart#','#trancodestart#',
            '',
            'rebate', 
            'Rebate', 
            '', 
            '',
            '1',
            #numberformat(val(form.rebate)*-1,'.__')#, 
            '#xunit#',
             #numberformat(val(form.rebate)*-1,'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(form.rebate)*-1,'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(form.rebate)*-1,'.__')#,
              '#xunit#',
              '1',
               '1',
                #numberformat(val(form.rebate)*-1,'.__')#,
                0,
                #numberformat(val(form.rebate)*-1,'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#huserid#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,

                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     <cfloop from="1" to="3" index="i">
     <cfset trancodestart = trancodestart + 1>
	 <cfif val(evaluate('form.dedcust#i#')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
                '#form.custno#',
                '#trancodestart#','#trancodestart#',
                '',
                'dedcust#i#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('form.ded#i#desp')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('form.dedcust#i#')*-1,'.__')#, 
                '#xunit#',
                 #numberformat(evaluate('form.dedcust#i#')*-1,'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('form.dedcust#i#')*-1,'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('form.dedcust#i#')*-1,'.__')#,
                  '#xunit#',
                  '1',
                   '1',
                    #numberformat(evaluate('form.dedcust#i#')*-1,'.__')#,
                    0,
                    #numberformat(evaluate('form.dedcust#i#')*-1,'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#huserid#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>
     
     <cfloop list="pb,aws" index="i">
     <cfset trancodestart = trancodestart + 1>
	 <cfif val(evaluate('form.#i#eramt')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
                '#form.custno#',
                '#trancodestart#','#trancodestart#',
                '',
                '#i#amt', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('form.#i#text')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('form.#i#eramt'),'.__')#, 
                '#xunit#',
                 #numberformat(evaluate('form.#i#eramt'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('form.#i#eramt'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('form.#i#eramt'),'.__')#,
                  '#xunit#',
                  '1',
                   '1',
                    #numberformat(evaluate('form.#i#eramt'),'.__')#,
                    0,
                    #numberformat(evaluate('form.#i#eramt'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#huserid#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
         
         
     </cfif>
     
     <cfset trancodestart = trancodestart + 1>
	 <cfif val(evaluate('form.total#i#miscfield')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#assignmentslipdate#">,
                '#form.custno#',
                '#trancodestart#','#trancodestart#',
                '',
                '#i#miscamt', 
                <cfif i eq "pb">
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#form.bonusmisctext#">, 
                <cfelse>
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#form.awsmisctext#">, 
                </cfif>
                '', 
                '',
                '1',
                #numberformat(evaluate('form.total#i#miscfield'),'.__')#, 
                '#xunit#',
                 #numberformat(evaluate('form.total#i#miscfield'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('form.total#i#miscfield'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('form.total#i#miscfield'),'.__')#,
                  '#xunit#',
                  '1',
                   '1',
                    #numberformat(evaluate('form.total#i#miscfield'),'.__')#,
                    0,
                    #numberformat(evaluate('form.total#i#miscfield'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 

                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#huserid#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#form.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
         
         
     </cfif>
     </cfloop>
     
     <cfquery name="updateasgn" datasource="#dts#">
     UPDATE assignmentslip set trancodestart = "#starttrancode#",trancodeend ="#trancodestart#",orirefno = "#form.refno#" WHERE refno = "#assignmentslipno#"
     </cfquery>
     
    <!---Added by Nieo 20170810 for period scenario fix--->
    <cfquery name="checkassignperiod" datasource="#dts#">
    SELECT startdate,completedate FROM assignmentslip 
    WHERE empno=<cfqueryparam cfsqltype="cf_sql_varchar" value="#form.empno#">
    AND payrollperiod=<cfqueryparam cfsqltype="cf_sql_varchar" value="#form.payrollperiod#">
    AND custno=<cfqueryparam cfsqltype="cf_sql_varchar" value="#form.custno#">
    AND placementno <> <cfqueryparam cfsqltype="cf_sql_varchar" value="#form.placementno#">
    AND custtotalgross = 0.00
    AND assignmenttype <>"invoice"
    AND posted=''
    ORDER BY refno
    </cfquery>                
    <!---Added by Nieo 20170810 for period scenario fix--->

    <!---Edited by Nieo 20170810 for period scenario fix--->               
    <cfquery name="updatebrem3" datasource="#dts#">
    UPDATE ictran SET brem3 = "<cfif checkassignperiod.recordcount neq 0><cfif datediff('d',startdate,checkassignperiod.startdate) lt 0>#dateformat(checkassignperiod.startdate,'dd Mmm YYYY')#<cfelse>#dateformat(startdate,'dd Mmm YYYY')#</cfif><cfelse>#dateformat(startdate,'dd Mmm YYYY')#</cfif>-<cfif checkassignperiod.recordcount neq 0><cfif datediff('d',completedate,checkassignperiod.completedate) gt 0>#dateformat(checkassignperiod.completedate,'dd Mmm YYYY')#<cfelse>#dateformat(completedate,'dd Mmm YYYY')#</cfif><cfelse>#dateformat(completedate,'dd Mmm YYYY')#</cfif>"
    WHERE refno = '#form.refno#' and type='INV' and trancode between "#starttrancode#" and "#trancodestart#"
    </cfquery>
    <!---Edited by Nieo 20170810 for period scenario fix--->
     
     <cfquery name="gettaxprofile" datasource="#dts#">
     SELECT arrem5 FROM arcust WHERE custno = "#form.custno#"
     </cfquery>
     
     <cfif gettaxprofile.arrem5 neq "">
     <cfquery name="gettaxmethod" datasource="#dts#">
     SELECT * FROM taxmethod WHERE taxname = "#gettaxprofile.arrem5#"
     </cfquery>
     <cfif gettaxmethod.billtaxable eq "Y">
     			<cfif val(form.taxper) neq 0>
    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=#numberformat(val(form.taxper),'.__')#,
                    note_a=<cfqueryparam cfsqltype="cf_sql_varchar" value="#form.taxcode#">,
                    taxamt=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(form.taxper),'.__')#/100)+0.000001,2),
                    taxamt_bil=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(form.taxper),'.__')#/100)+0.000001,2)
					where refno = '#form.refno#' and type='INV'
		  		</cfquery>
                </cfif>  
     <cfelse>

    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=0,
                    note_a="OS",
                    taxamt=0,
                    taxamt_bil=0
					where refno = '#form.refno#' and type='INV'
		  		</cfquery>
         
	 </cfif>
     
     <cfif gettaxmethod.adminfeetaxable eq "Y">
     		<cfif val(form.taxper) neq 0>
    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=#numberformat(val(form.taxper),'.__')#,
                    note_a=<cfqueryparam cfsqltype="cf_sql_varchar" value="#form.taxcode#">,
                    taxamt=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(form.taxper),'.__')#/100)+0.000001,2),
                    taxamt_bil=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(form.taxper),'.__')#/100)+0.000001,2)
					where refno = '#form.refno#' 
                    and type='INV'
                    and itemno = "adminfee"
		  		</cfquery>
     
                </cfif>
     <cfelse>
     		<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=0,
                    note_a="OS",
                    taxamt=0,
                    taxamt_bil=0
					where refno = '#form.refno#' and type='INV' and itemno = "adminfee"
		  		</cfquery>
	 </cfif>
     
     <cfif gettaxmethod.taxableitem eq "Y">
     
     	<cfquery name="gettaxitem" datasource="#dts#">
        SELECT taxitemid FROM taxmethoditem WHERE taxmethodid = "#gettaxmethod.id#"
        </cfquery> 
        
     		<cfif val(form.taxper) neq 0 and gettaxitem.recordcount neq 0>
    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=#numberformat(val(form.taxper),'.__')#,
                    note_a=<cfqueryparam cfsqltype="cf_sql_varchar" value="#form.taxcode#">,
                    taxamt=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(form.taxper),'.__')#/100)+0.000001,2),
                    taxamt_bil=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(form.taxper),'.__')#/100)+0.000001,2)
					where refno = '#form.refno#' 
                    and type='INV'
                    and trim(right(itemno,3)) in (<cfqueryparam cfsqltype="cf_sql_varchar" value="#valuelist(gettaxitem.taxitemid)#" separator="," list="yes">)
		  		</cfquery>
     
                </cfif>
         </cfif>
     
     <cfelse>
     <cfif val(form.taxper) neq 0>
    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=#numberformat(val(form.taxper),'.__')#,
                    note_a=<cfqueryparam cfsqltype="cf_sql_varchar" value="#form.taxcode#">,
                    taxamt=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(form.taxper),'.__')#/100)+0.000001,2),
                    taxamt_bil=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(form.taxper),'.__')#/100)+0.000001,2)
					where refno = '#form.refno#' and type='INV'
		  		</cfquery>
                </cfif>
     </cfif>
	 
	 <cfquery name="checkinvamt" datasource="#dts#">
			SELECT itemno from ictran 
			where type='INV'
			AND refno = "#form.refno#"
			and (void ='' or void is null)
			and amt<>0
		</cfquery>
		<cfif checkinvamt.recordcount eq 0>
			<cfquery name="voidartran" datasource="#dts#">
				update artran
				set void='Y',
				rem30=<cfqueryparam cfsqltype="cf_sql_varchar" value="System auto void due to amount 0.00">,
				updated_by= '#Huserid#',
				updated_on=now()
				where type='INV'
				AND refno = "#form.refno#"
			</cfquery>
		<cfelse>
			<cfquery name="voidartran" datasource="#dts#">
				update artran
				set void='',
				rem30=<cfqueryparam cfsqltype="cf_sql_varchar" value="">,
				updated_by= '#Huserid#',
				updated_on=now()
				where type='INV'
				AND refno = "#form.refno#"
			</cfquery>
		</cfif>
	 
	 <cfif isdefined('refnofound')>
		<cfquery name="checkinvamt" datasource="#dts#">
			SELECT itemno from ictran 
			where type='INV'
			AND refno = "#refnofound#"
			and (void ='' or void is null)
			and amt<>0
		</cfquery>
		<cfif checkinvamt.recordcount eq 0>
			<cfquery name="voidartran" datasource="#dts#">
				update artran
				set void='Y',
				rem30=<cfqueryparam cfsqltype="cf_sql_varchar" value="System auto void due to amount 0.00">,
				updated_by= '#Huserid#',
				updated_on=now()
				where type='INV'
				AND refno = "#refnofound#"
			</cfquery>
		<cfelse>
			<cfquery name="voidartran" datasource="#dts#">
				update artran
				set void='',
				rem30=<cfqueryparam cfsqltype="cf_sql_varchar" value="">,
				updated_by= '#Huserid#',
				updated_on=now()
				where type='INV'
				AND refno = "#refnofound#"
			</cfquery>
		</cfif>
	</cfif>
     
	<cfset tran = "INV">
	<cfset url.nexttranno = form.refno>
	<cfinclude template="recalculatebill.cfm">
	
	<cfif isdefined('getorirefno')>
    	<cfset tran = "INV">
		<cfset url.nexttranno = getorirefno.refno>
		<cfinclude template="recalculatebill.cfm">
    </cfif>
	</cfif>