
<cfif left(form.refno,1) neq 's'>
	<cfoutput>
	<br> ictranbody ran for #form.refno#
    </cfoutput>
     <cfset trancodestarttemp = 0>
     <cfif isdefined('refnofound') >
     <!--- refresh ictran --->
     <cfquery name="getorirefno" datasource="#dts#">
     SELECT refno as invoiceno,(select posted from artran where refno =a.refno) as posted  FROM ictran a WHERE brem6 = "#assignmentslipno#" 
     GROUP BY brem6
     </cfquery>

     <cfquery name="voidictran" datasource="#dts#">
     UPDATE ictran
     SET void='Y'
     WHERE brem6 = "#assignmentslipno#"
	 and refno in (select refno from artran where posted='')
     </cfquery>
     <cfquery name="resettrancode" datasource="#dts#">
     UPDATE assignmentslip
     SET trancodestart=0,trancodeend=0 
     WHERE refno = "#assignmentslipno#"
     </cfquery>
     <!--- refresh ictran --->
     <cfquery name="checkassign" datasource="#dts#">
     SELECT trancodestart,trancodeend FROM assignmentslip WHERE refno = "#assignmentslipno#"
     </cfquery>
     <cfif checkassign.trancodestart eq 0 and checkassign.trancodeend eq 0>
         <cfquery name="getlatesttrancode" datasource="#dts#">
         SELECT trancode FROM ictran WHERE refno = "#refnofound#"
         and type = "INV"
         ORDER BY trancode desc
         </cfquery>
         
         <cfif getlatesttrancode.recordcount eq 0>
         	<cfset trancodestarttemp = 0>
         <cfelse>
         	<cfset trancodestarttemp = val(getlatesttrancode.trancode)+56>
            <br> trancodestarttemp = val(getlatesttrancode.trancode)+56
         </cfif>
     <cfelse>
     	   <cfset trancodestarttemp = val(checkassign.trancodestart)-1>
           <br> trancodestarttemp = val(checkassign.trancodestart)-1
     </cfif>
	 </cfif>
     <cfset starttrancode = trancodestarttemp + 1>
     
     <!---Name--->
     <cfset trancodestarttemp += 1>
     <cfoutput>
     <br> Name #trancodestarttemp#
     </cfoutput>
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,
            currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'Name', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.empname# (#getposition.position#)">, 
            '', 
            '',
            '0',
            0, 
            '',
             0,
            0,
            0,
            0,
            0,
            0, 
            '0',
            '',
            0.00000,
            '0',
             0,
              '',
              '0',
               '0',
                0,
                0,
                0,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     
	 <cfif val(getassignment.custsalary) neq 0> 
     <!---Salary---->
     <cfset xqty=1>
     <cfif getassignment.invdesp2 eq "">
     <cfif getassignment.paymenttype eq 'hr'>
     <cfset xqty=val(getassignment.custsalaryhrs)>
     <cfelseif getassignment.paymenttype eq 'day' >
     <cfset xqty=val(getassignment.custsalaryday)>
     </cfif>
     
     <cfset xprice=val(getassignment.custsalary)>
     <cfif getassignment.paymenttype eq 'hr'>
     <cfset xprice=val(getassignment.custusualpay)>
     <cfelseif getassignment.paymenttype eq 'day' >
     <cfset xprice=val(getassignment.custusualpay)>
     </cfif>
     <cfelse>
     <cfset xprice = numberformat(getassignment.custsalary,'_.__')>
     </cfif>
     <cfif val(getassignment.firstrate) neq 0 and val(getassignment.secondrate) neq 0>
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,
            currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'Salary', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="Normal">, 
            '', 
            '',
            '#val(xqty)#',
            #numberformat(val(getassignment.firstrate),'.__')#, 
            '',
             #numberformat(val(getassignment.firstrate),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.firstrate),'.__')#, 
            '0',
            '',
            0.00000,
            '#val(xqty)#',
             #numberformat(val(getassignment.firstrate),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.firstrate),'.__')#,
                0,
                #numberformat(val(getassignment.firstrate),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     
     
      <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,
            currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'Salary', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="Normal">, 
            '', 
            '',
            '#val(xqty)#',
            #numberformat(val(getassignment.secondrate),'.__')#, 
            '',
             #numberformat(val(getassignment.secondrate),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.secondrate),'.__')#, 
            '0',
            '',
            0.00000,
            '#val(xqty)#',
             #numberformat(val(getassignment.secondrate),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.secondrate),'.__')#,
                0,
                #numberformat(val(getassignment.secondrate),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     
     <cfelse>
	 <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,
            currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'Salary', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="Normal">, 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="">, 
            '',
            '#val(xqty)#',
            #numberformat(val(xprice),'.__')#, 
            '',
             #numberformat(val(getassignment.custsalary),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.custsalary),'.__')#, 
            '0',
            '',
            0.00000,
            '#val(xqty)#',
             #numberformat(val(xprice),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.custsalary),'.__')#,
                0,
                #numberformat(val(getassignment.custsalary),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     </cfif>
     
     
     <cfloop from="1" to="10" index="i">
     <cfset trancodestarttemp = trancodestarttemp + 1>
	 <cfif evaluate('getassignment.lvltype#i#') neq "" and val(evaluate('getassignment.lvltotaler#i#')) neq 0 and val(evaluate('getassignment.lvlerdayhr#i#')) neq 0 and val(evaluate('getassignment.lvlerrate#i#')) neq 0 >
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
                '#getassignment.custno#',
                '#trancodestarttemp#','#trancodestarttemp#',
                '',
                'leave#i#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('getassignment.lvldesp#i#')#">, 
                '', 
                '',
                '#val(evaluate('getassignment.lvlerdayhr#i#'))#',
                #numberformat(evaluate('getassignment.lvlerrate#i#'),'.__')#, 
                '',
                 #numberformat(evaluate('getassignment.lvltotaler#i#'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('getassignment.lvltotaler#i#'),'.__')#, 
                '0',
                '',
                0.00000,
                '#val(evaluate('getassignment.lvlerdayhr#i#'))#',
                 #numberformat(evaluate('getassignment.lvlerrate#i#'),'.__')#,
                  '',
                  '1',
                   '1',
                    #numberformat(evaluate('getassignment.lvltotaler#i#'),'.__')#,
                    0,
                    #numberformat(evaluate('getassignment.lvltotaler#i#'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#getassignment.created_by#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>
     
     
     <cfloop from="1" to="8" index="i">
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(evaluate('getassignment.custotrate#i#')) neq 0 and val(evaluate('getassignment.custothour#i#')) neq 0 and val(evaluate('getassignment.custot#i#')) neq 0> 
     <!---OT---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'OT#i#', 
            '<cfif i eq 1>Over Time 1.0<cfelseif i eq 2>Over Time 1.5<cfelseif i eq 3>Over Time 2.0<cfelseif i eq 4>Over Time 3.0<cfelseif i eq 5>Rest Day 1.0<cfelseif i eq 6>Rest Day 2.0<cfelseif i eq 7>Public Holiday 1.0<cfelse>Public Holiday 2.0</cfif>', 
            '', 
            '',
            '#val(evaluate('getassignment.custothour#i#'))#',
            #numberformat(evaluate('getassignment.custotrate#i#'),'.__')#, 
            '',
             #numberformat(evaluate('getassignment.custot#i#'),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(evaluate('getassignment.custot#i#'),'.__')#, 
            '0',
            '',
            0.00000,
            '#val(evaluate('getassignment.custothour#i#'))#',
             #numberformat(evaluate('getassignment.custotrate#i#'),'.__')#,
              '',
              '1',
               '1',
                #numberformat(evaluate('getassignment.custot#i#'),'.__')#,
                0,
                #numberformat(evaluate('getassignment.custot#i#'),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     </cfloop>
     
     <!--- Fixed allowance --->
     
     <cfloop from="1" to="6" index="i">
     <cfset trancodestarttemp = trancodestarttemp + 1>
	 <cfif evaluate('getassignment.fixawcode#i#') neq "" and val(evaluate('getassignment.fixawer#i#')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,brem5,brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
                '#getassignment.custno#',
                '#trancodestarttemp#','#trancodestarttemp#',
                '',
                '#evaluate('getassignment.fixawcode#i#')#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('getassignment.fixawdesp#i#')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('getassignment.fixawer#i#'),'.__')#, 
                '',
                 #numberformat(evaluate('getassignment.fixawer#i#'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('getassignment.fixawer#i#'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('getassignment.fixawer#i#'),'.__')#,
                  '',
                  '1',
                   '1',
                    #numberformat(evaluate('getassignment.fixawer#i#'),'.__')#,
                    0,
                    #numberformat(evaluate('getassignment.fixawer#i#'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#getassignment.created_by#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>     
     
     
     <cfloop from="1" to="18" index="i">
     <cfset trancodestarttemp = trancodestarttemp + 1>
	 <cfif evaluate('getassignment.allowance#i#') neq "" and val(evaluate('getassignment.awer#i#')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,brem5,brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
                '#getassignment.custno#',
                '#trancodestarttemp#','#trancodestarttemp#',
                '',
                '#evaluate('getassignment.allowance#i#')#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('getassignment.allowancedesp#i#')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('getassignment.awer#i#'),'.__')#, 
                '',
                 #numberformat(evaluate('getassignment.awer#i#'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('getassignment.awer#i#'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('getassignment.awer#i#'),'.__')#,
                  '',
                  '1',
                   '1',
                    #numberformat(evaluate('getassignment.awer#i#'),'.__')#,
                    0,
                    #numberformat(evaluate('getassignment.awer#i#'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#getassignment.created_by#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>
     
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.custallowancerate4) neq 0>
     <!---Allowance 4---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'allowance4', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.aw104desp#">, 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.custallowancerate4),'.__')#, 
            '',
             #numberformat(val(getassignment.custallowancerate4),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.custallowancerate4),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.custallowancerate4),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.custallowancerate4),'.__')#,
                0,
                #numberformat(val(getassignment.custallowancerate4),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
      <cfif val(getassignment.custallowancerate5) neq 0>
     <!---Allowance 5---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'allowance5', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.aw105desp#">, 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.custallowancerate5),'.__')#, 
            '',
             #numberformat(val(getassignment.custallowancerate5),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.custallowancerate5),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.custallowancerate5),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.custallowancerate5),'.__')#,
                0,
                #numberformat(val(getassignment.custallowancerate5),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
      <cfif val(getassignment.custallowancerate6) neq 0>
     <!---Allowance 6---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'allowance6', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.aw106desp#">, 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.custallowancerate6),'.__')#, 
            '',
             #numberformat(val(getassignment.custallowancerate6),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.custallowancerate6),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.custallowancerate6),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.custallowancerate6),'.__')#,
                0,
                #numberformat(val(getassignment.custallowancerate6),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.custpayback) neq 0> 
     <!---BACK PAY---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'backoverpay', 
            <cfif val(getassignment.custpayback) lt 0>'Over Pay'<cfelse>'Back Pay'</cfif>, 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.custpayback),'.__')#, 
            '',
             #numberformat(val(getassignment.custpayback),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.custpayback),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.custpayback),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.custpayback),'.__')#,
                0,
                #numberformat(val(getassignment.custpayback),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.custcpf) neq 0> 
     <!---CPF---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'EPF', 
            'EPF', 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.custcpf),'.__')#, 
            '',
             #numberformat(val(getassignment.custcpf),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.custcpf),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.custcpf),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.custcpf),'.__')#,
                0,
                #numberformat(val(getassignment.custcpf),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.custsdf) neq 0>
     <!---SOCSO---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'SOCSO YER', 
            'SOCSO YER', 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.custsdf),'.__')#, 
            '',
             #numberformat(val(getassignment.custsdf),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.custsdf),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.custsdf),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.custsdf),'.__')#,
                0,
                #numberformat(val(getassignment.custsdf),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.nscustded) neq 0>
     <!---NS DEDUCTION---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (

            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'NS', 
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.nsdeddesp#">, 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.nscustded)*-1,'.__')#, 
            '',
             #numberformat(val(getassignment.nscustded)*-1,'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.nscustded)*-1,'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.nscustded)*-1,'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.nscustded)*-1,'.__')#,
                0,
                #numberformat(val(getassignment.nscustded)*-1,'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
      <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.adminfee) neq 0>
     <!---NS DEDUCTION---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'adminfee', 
            'Admin Fee', 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.adminfee),'.__')#, 
            '',
             #numberformat(val(getassignment.adminfee),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.adminfee),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.adminfee),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.adminfee),'.__')#,
                0,
                #numberformat(val(getassignment.adminfee),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     <cfloop from="1" to="6" index="i">
     <cfset trancodestarttemp = trancodestarttemp + 1>
	 <cfif evaluate('getassignment.billitem#i#') neq "" and val(evaluate('getassignment.billitemamt#i#')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
                '#getassignment.custno#',
                '#trancodestarttemp#','#trancodestarttemp#',
                '',
                '#evaluate('getassignment.billitem#i#')#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('getassignment.billitemdesp#i#')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('getassignment.billitemamt#i#'),'.__')#, 
                '',
                 #numberformat(evaluate('getassignment.billitemamt#i#'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('getassignment.billitemamt#i#'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('getassignment.billitemamt#i#'),'.__')#,
                  '',
                  '1',
                   '1',
                    #numberformat(evaluate('getassignment.billitemamt#i#'),'.__')#,
                    0,
                    #numberformat(evaluate('getassignment.billitemamt#i#'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#getassignment.created_by#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>
     
     
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.addchargecust) neq 0>
     
     <!---other 1---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'other - #getassignment.addchargecode#', 
            '#addchargedesp#', 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.addchargecust),'.__')#, 
            '',
             #numberformat(val(getassignment.addchargecust),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.addchargecust),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.addchargecust),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.addchargecust),'.__')#,
                0,
                #numberformat(val(getassignment.addchargecust),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     
     
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.addchargecust2) neq 0>
     
     <!---other 2---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'other2 - #getassignment.addchargecode#', 
            '#addchargedesp2#', 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.addchargecust2),'.__')#, 
            '',
             #numberformat(val(getassignment.addchargecust2),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.addchargecust2),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.addchargecust2),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.addchargecust2),'.__')#,
                0,
                #numberformat(val(getassignment.addchargecust2),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.addchargecust3) neq 0>
     <!---other 3---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'other3', 
            '#addchargedesp3#', 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.addchargecust3),'.__')#, 
            '',
             #numberformat(val(getassignment.addchargecust3),'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.addchargecust3),'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.addchargecust3),'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.addchargecust3),'.__')#,
                0,
                #numberformat(val(getassignment.addchargecust3),'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,
                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
     <cfif val(getassignment.rebate) neq 0>
     <!---Rebate---->
     <cfquery name="insertictran" datasource="#dts#">
        insert ignore ictran
        (
            type,
            refno,
            fperiod,
            wos_date,
            custno,
            trancode,
            itemcount,
            linecode,
            itemno,
            desp,
            despa,
            location,
            qty_bil,
            price_bil,
            unit_bil,
            amt1_bil,
            dispec1,
            dispec2,
            dispec3,
            disamt_bil,
            amt_bil,
            taxpec1,
            gltradac,
            taxamt_bil,
            qty,
            price,
            unit,
            factor1,
            factor2,
            amt1,
            disamt,
            amt,
            taxamt,
            note_a,
            dono,
            exported,
            exported1,
            sono,
            toinv,
            generated,
            wos_group,
            category,
            brem1,
            brem2,
            brem3,
            brem4,
            packing,
            shelf,
            supp,
            qty1,
            qty2,
            qty3,
            qty4,
            qty5,
            qty6,
            qty7,
            trdatetime,
            sv_part,
            sercost,
            userid,
            sodate,
            dodate,
            adtcost1,
            adtcost2,
            batchcode,
            expdate,
            mc1_bil,
            mc2_bil,
            defective,
            nodisplay,
            title_id,
            title_desp,
            comment,
            m_charge1,
            m_charge2,
            m_charge3,
            m_charge4,
            m_charge5,
            m_charge6,
            m_charge7,
            mc3_bil,
            mc4_bil,
            mc5_bil,
            mc6_bil,
            mc7_bil,currrate,
            brem5,
            brem6
            )
            values
            (
            'INV',
            '#form.refno#',
            <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
        	<cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
            '#getassignment.custno#',
            '#trancodestarttemp#','#trancodestarttemp#',
            '',
            'rebate', 
            'Rebate', 
            '', 
            '',
            '1',
            #numberformat(val(getassignment.rebate)*-1,'.__')#, 
            '',
             #numberformat(val(getassignment.rebate)*-1,'.__')#,
            0,
            0,
            0,
            0,
            #numberformat(val(getassignment.rebate)*-1,'.__')#, 
            '0',
            '',
            0.00000,
            1,
             #numberformat(val(getassignment.rebate)*-1,'.__')#,
              '',
              '1',
               '1',
                #numberformat(val(getassignment.rebate)*-1,'.__')#,
                0,
                #numberformat(val(getassignment.rebate)*-1,'.__')#,
                0.00000,
                '',
                '',
                  '', 
                  '0000-00-00', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '', 
                  '',
                  '', 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  now(),
                  '',
                  0.00000,
                  '#getassignment.created_by#',
                  '0000-00-00',
                  '0000-00-00', 
                  0.00000, 
                  0.00000,
                  '',
                  '0000-00-00',
                  0.00000, 
                  0.00000,

                  '',
                  'N',
                  '',
                  '',
                  '',
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,
                  0.00000, 
                  0.00000, 
                  0.00000, 
                  0.00000,
                  0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
            )
   	 </cfquery>
     </cfif>
     
     
     <cfloop from="1" to="3" index="i">
     <cfset trancodestarttemp = trancodestarttemp + 1>
	 <cfif val(evaluate('getassignment.dedcust#i#')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
                '#getassignment.custno#',
                '#trancodestarttemp#','#trancodestarttemp#',
                '',
                'dedcust#i#', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('getassignment.ded#i#desp')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('getassignment.dedcust#i#')*-1,'.__')#, 
                '',
                 #numberformat(evaluate('getassignment.dedcust#i#')*-1,'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('getassignment.dedcust#i#')*-1,'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('getassignment.dedcust#i#')*-1,'.__')#,
                  '',
                  '1',
                   '1',
                    #numberformat(evaluate('getassignment.dedcust#i#')*-1,'.__')#,
                    0,
                    #numberformat(evaluate('getassignment.dedcust#i#')*-1,'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#getassignment.created_by#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
     </cfif>
     </cfloop>
     
     <cfloop list="pb,aws" index="i">
     <cfset trancodestarttemp = trancodestarttemp + 1>
	 <cfif val(evaluate('getassignment.#i#eramt')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
                '#getassignment.custno#',
                '#trancodestarttemp#','#trancodestarttemp#',
                '',
                '#i#amt', 
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#evaluate('getassignment.#i#text')#">, 
                '', 
                '',
                '1',
                #numberformat(evaluate('getassignment.#i#eramt'),'.__')#, 
                '',
                 #numberformat(evaluate('getassignment.#i#eramt'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('getassignment.#i#eramt'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('getassignment.#i#eramt'),'.__')#,
                  '',
                  '1',
                   '1',
                    #numberformat(evaluate('getassignment.#i#eramt'),'.__')#,
                    0,
                    #numberformat(evaluate('getassignment.#i#eramt'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#getassignment.created_by#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
         
         
     </cfif>
     
     <cfset trancodestarttemp = trancodestarttemp + 1>
	 <cfif val(evaluate('getassignment.total#i#misc')) neq 0>
          <cfquery name="insertictran" datasource="#dts#">
            insert ignore ictran
            (
                type,
                refno,
                fperiod,
                wos_date,
                custno,
                trancode,
                itemcount,
                linecode,
                itemno,
                desp,
                despa,
                location,
                qty_bil,
                price_bil,
                unit_bil,
                amt1_bil,
                dispec1,
                dispec2,
                dispec3,
                disamt_bil,
                amt_bil,
                taxpec1,
                gltradac,
                taxamt_bil,
                qty,
                price,
                unit,
                factor1,
                factor2,
                amt1,
                disamt,
                amt,
                taxamt,
                note_a,
                dono,
                exported,
                exported1,
                sono,
                toinv,
                generated,
                wos_group,
                category,
                brem1,
                brem2,
                brem3,
                brem4,
                packing,
                shelf,
                supp,
                qty1,
                qty2,
                qty3,
                qty4,
                qty5,
                qty6,
                qty7,
                trdatetime,
                sv_part,
                sercost,
                userid,
                sodate,
                dodate,
                adtcost1,
                adtcost2,
                batchcode,
                expdate,
                mc1_bil,
                mc2_bil,
                defective,
                nodisplay,
                title_id,
                title_desp,
                comment,
                m_charge1,
                m_charge2,
                m_charge3,
                m_charge4,
                m_charge5,
                m_charge6,
                m_charge7,
                mc3_bil,
                mc4_bil,
                mc5_bil,
                mc6_bil,
                mc7_bil,currrate,
                brem5,
                brem6
                )
                values
                (
                'INV',
                '#form.refno#',
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#fperiod#">,
                <cfqueryparam cfsqltype="cf_sql_varchar" value="2017-03-14">,
                '#getassignment.custno#',
                '#trancodestarttemp#','#trancodestarttemp#',
                '',
                '#i#miscamt', 
                <cfif i eq "pb">
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.bonusmisctext#">, 
                <cfelse>
                <cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.awsmisctext#">, 
                </cfif>
                '', 
                '',
                '1',
                #numberformat(evaluate('getassignment.total#i#misc'),'.__')#, 
                '',
                 #numberformat(evaluate('getassignment.total#i#misc'),'.__')#,
                0,
                0,
                0,
                0,
                #numberformat(evaluate('getassignment.total#i#misc'),'.__')#, 
                '0',
                '',
                0.00000,
                1,
                 #numberformat(evaluate('getassignment.total#i#misc'),'.__')#,
                  '',
                  '1',
                   '1',
                    #numberformat(evaluate('getassignment.total#i#misc'),'.__')#,
                    0,
                    #numberformat(evaluate('getassignment.total#i#misc'),'.__')#,
                    0.00000,
                    '',
                    '',
                      '', 
                      '0000-00-00', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 
                      '', 

                      '',
                      '', 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      now(),
                      '',
                      0.00000,
                      '#getassignment.created_by#',
                      '0000-00-00',
                      '0000-00-00', 
                      0.00000, 
                      0.00000,
                      '',
                      '0000-00-00',
                      0.00000, 
                      0.00000,
                      '',
                      'N',
                      '',
                      '',
                      '',
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,
                      0.00000, 
                      0.00000, 
                      0.00000, 
                      0.00000,
                      0.00000,1,
                  "#getassignment.empno#",

                  "#assignmentslipno#"
                )
         </cfquery>
         
         
     </cfif>
     </cfloop>
     
     <cfoutput>
     <br> trancodestarttemp #starttrancode#, trancodeend #trancodestarttemp#, assignmentslipno #assignmentslipno#
     </cfoutput>
     
     <cfquery name="updateasgn" datasource="#dts#">
     UPDATE assignmentslip set trancodestart = "#starttrancode#",trancodeend ="#trancodestarttemp#",orirefno = "#form.refno#" WHERE refno = "#assignmentslipno#"
     </cfquery>
     
     <cfquery name="updatebrem3" datasource="#dts#">
     UPDATE ictran SET brem3 = "#dateformat(getassignment.startdate,'dd Mmm YYYY')#-#dateformat(getassignment.completedate,'dd Mmm YYYY')#"
     WHERE refno = '#form.refno#' and type='INV' and trancode between "#starttrancode#" and "#trancodestarttemp#"
     </cfquery>
     
     <cfquery name="gettaxprofile" datasource="#dts#">
     SELECT arrem5 FROM arcust WHERE custno = "#getassignment.custno#"
     </cfquery>
     
     <cfif gettaxprofile.arrem5 neq "">
     <cfquery name="gettaxmethod" datasource="#dts#">
     SELECT * FROM taxmethod WHERE taxname = "#gettaxprofile.arrem5#"
     </cfquery>
     <cfif gettaxmethod.billtaxable eq "Y">
     			<cfif val(getassignment.taxper) neq 0>
    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=#numberformat(val(getassignment.taxper),'.__')#,
                    note_a=<cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.taxcode#">,
                    taxamt=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(getassignment.taxper),'.__')#/100)+0.000001,2),
                    taxamt_bil=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(getassignment.taxper),'.__')#/100)+0.000001,2)
					where refno = '#form.refno#' and type='INV'
		  		</cfquery>
                </cfif>  
     <cfelse>

    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=0,
                    note_a="OS",
                    taxamt=0,
                    taxamt_bil=0
					where refno = '#form.refno#' and type='INV'
		  		</cfquery>
         
	 </cfif>
     
     <cfif gettaxmethod.adminfeetaxable eq "Y">
     		<cfif val(getassignment.taxper) neq 0>
    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=#numberformat(val(getassignment.taxper),'.__')#,
                    note_a=<cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.taxcode#">,
                    taxamt=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(getassignment.taxper),'.__')#/100)+0.000001,2),
                    taxamt_bil=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(getassignment.taxper),'.__')#/100)+0.000001,2)
					where refno = '#form.refno#' 
                    and type='INV'
                    and itemno = "adminfee"
		  		</cfquery>
     
                </cfif>
     <cfelse>
     		<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=0,
                    note_a="OS",
                    taxamt=0,
                    taxamt_bil=0
					where refno = '#form.refno#' and type='INV' and itemno = "adminfee"
		  		</cfquery>
	 </cfif>
     
     <cfif gettaxmethod.taxableitem eq "Y">
     
     	<cfquery name="gettaxitem" datasource="#dts#">
        SELECT taxitemid FROM taxmethoditem WHERE taxmethodid = "#gettaxmethod.id#"
        </cfquery> 
        
     		<cfif val(getassignment.taxper) neq 0 and gettaxitem.recordcount neq 0>
    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=#numberformat(val(getassignment.taxper),'.__')#,
                    note_a=<cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.taxcode#">,
                    taxamt=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(getassignment.taxper),'.__')#/100)+0.000001,2),
                    taxamt_bil=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(getassignment.taxper),'.__')#/100)+0.000001,2)
					where refno = '#form.refno#' 
                    and type='INV'
                    and trim(right(itemno,3)) in (<cfqueryparam cfsqltype="cf_sql_varchar" value="#valuelist(gettaxitem.taxitemid)#" separator="," list="yes">)
		  		</cfquery>
     
                </cfif>
         </cfif>
     
     <cfelse>
     <cfif val(getassignment.taxper) neq 0>
    			<cfquery datasource='#dts#' name="updateictran">
					Update ictran 
					set 
                    taxpec1=#numberformat(val(getassignment.taxper),'.__')#,
                    note_a=<cfqueryparam cfsqltype="cf_sql_varchar" value="#getassignment.taxcode#">,
                    taxamt=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(getassignment.taxper),'.__')#/100)+0.000001,2),
                    taxamt_bil=round((round(coalesce(amt,'0')+0.000001,2) * #numberformat(val(getassignment.taxper),'.__')#/100)+0.000001,2)
					where refno = '#form.refno#' and type='INV'
		  		</cfquery>
                </cfif>
     </cfif>
     
     
	<cfset tran = "INV">
	<cfset url.nexttranno = form.refno>
	<cfinclude template="recalculatebill.cfm">
    
    <cfif isdefined('getorirefno.invoiceno') >
    	<cfif getorirefno.posted  eq ''> 
    		<cfset tran = "INV">
			<cfset url.nexttranno = getorirefno.invoiceno>
			<cfinclude template="recalculatebill.cfm">
        </cfif>
     </cfif>
     
</cfif>